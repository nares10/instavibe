{% extends 'instavibeapp/base.html' %}

{% block content %}
{% load static %}
<div class="container mx-auto px-4 py-8 max-w-2xl">
    <div class="bg-white rounded-lg shadow-md">

        {# Post Header #}
        <div class="p-4 border-b">
            <div class="flex items-center justify-between mb-4">
                <a href="{% url 'instavibeapp:profile' %}">
                   <img class="logo" alt="App logo" src="{% static 'instavibeapp/images/black--back-button.png' %}" width="20" height="20">
                </a>
                <h2 class="text-xl font-semibold">Comments</h2>
            </div>

            {# Post Image and Caption #}
            <div class="mb-4 flex items-center gap-6">
                <img src="{{ post.image.url }}" alt="Post Image"
                     class="w-[100px] h-[100px] object-cover rounded-full">
                <p class="text-gray-800 text-lg">{{ post.caption }}</p>
            </div>
        </div>

        {# Add Comment Form #}
        <div class="p-4 border-b">
            <form method="POST" action="{% url 'instavibeapp:add_comment' post.id %}" class="flex gap-2">
                {% csrf_token %}
                <input type="text" name="text"
                       placeholder="Add a comment..."
                       class="flex-grow px-4 py-2 border border-gray-300 rounded-lg
                              focus:outline-none focus:ring-2 focus:ring-blue-500"
                       required>
                <button type="submit"
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg
                               hover:bg-blue-700 transition duration-200">
                    Post
                </button>
            </form>
        </div>

        {# Comments List #}
        <div class="divide-y my-4">
            {% for comment in comments %}
                <div class="p-4 hover:bg-gray-50">
                    <div class="flex items-center justify-between">
                        {# User Info #}
                        <div class="flex items-center gap-2">
                            {% if comment.user.profile.image %}
                                <img src="{{ comment.user.profile.image.url }}" 
                                     alt="Profile" 
                                     class="w-8 h-8 rounded-full object-cover">
                            {% endif %}
                            <span class="text-black font-medium">{{ comment.user.username }}</span>
                        </div>

                        {# Delete Button + Timestamp #}
                        <div class="flex items-center gap-4">
                            {% if user == comment.user %}
                                <form method="POST" action="{% url 'instavibeapp:delete_comment' comment.id %}"
                                      onsubmit="return confirm('Are you sure you want to delete this comment?')">
                                    {% csrf_token %}
                                    <button type="submit" 
                                        class="px-2 text-sm font-medium text-white bg-red-500 rounded-md shadow-sm 
                                               hover:bg-red-600 hover:shadow-md 
                                               active:bg-red-700 active:scale-95 
                                               transition duration-200 ease-in-out">
                                        Delete
                                    </button>
                                </form>
                            {% endif %}
                            <span class="text-sm text-gray-500">
                                {{ comment.created_at|timesince }} ago
                            </span>
                        </div>
                    </div>
                    {# Comment text itself #}
                    <p class="mt-2 text-gray-800 break-words whitespace-pre-wrap">{{ comment.text }}</p>
                </div>
            {% empty %}
                <div class="p-4 text-center text-gray-500">
                    No comments yet. Be the first to comment!
                </div>
            {% endfor %}
        </div>

    </div>
</div>
{% endblock %}
